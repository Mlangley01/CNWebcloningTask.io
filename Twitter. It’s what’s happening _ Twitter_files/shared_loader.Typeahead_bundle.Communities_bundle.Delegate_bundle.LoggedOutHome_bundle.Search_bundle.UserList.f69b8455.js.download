(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"4e/K":function(e,t,s){"use strict";s.r(t),s.d(t,"TypeaheadInput",(function(){return S})),s.d(t,"styles",(function(){return x}));var o=s("3EFP"),r=s("ERkP"),i=s.n(r),a=s("ZUOq"),n=s("+Kfv"),d=s("woHV"),c=s("3XMw"),h=s.n(c),l=s("VwDm"),u=s("WPfJ"),p=s("N5qz"),m=s("Es6L"),f=s("OEYw"),y=s("GZwR"),_=s("MWbm"),w=s("v6aA"),I=s("rHpw"),b=s("xoZN"),D=s("6OUF"),g=s("pf9B"),C=s("cHvH"),R=s("oEoC");const v=h.a.f065ba8c,E={viewType:"typeahead_input"},T=e=>p.a.isTwoColumnNormalLayout(e)?{width:a.a.columnWidths.secondary.normal+I.a.theme.spacesPx.space24,left:-I.a.theme.spacesPx.space24/2}:p.a.isTwoColumnSmallLayout(e)?{width:a.a.columnWidths.secondary.small+I.a.theme.spacesPx.space16,left:-I.a.theme.spacesPx.space16/2}:void 0;let O=1;class S extends i.a.Component{constructor(e,t){super(e,t),this._withNewTypeaheadUI=!1,this._render=({windowWidth:e})=>{const{alwaysOpen:t,disableClearButton:s,forceVdlDisable:o,inputStyle:r,isCompact:a,isOnHomepage:c,placeholder:h,renderInSearchField:u,rounded:p,shouldAutoFocus:m,shouldFocusOnClear:f,style:y,testID:w}=this.props,I=this.state.showTypeaheadDropdown||t;return i.a.createElement(n.a,{behavioralEventContext:E},i.a.createElement(_.a,{onLayout:this._handleLayout,ref:this._setRootContainerNode,style:[x.root,y]},i.a.createElement(b.a,{onKeyDown:this._handleKeyDown,style:x.keydownInputListener},i.a.createElement(d.a,{accessibilityLabel:h,accessibilityRole:"search",onSubmit:this._handleFormSubmit,style:x.wrapper},i.a.createElement(_.a,{ref:this._setInputContainerNode,style:r},i.a.createElement(D.a,{Icon:l.a,ariaActiveDescendant:this.state.ariaDescendantId,ariaAutocomplete:"list",ariaExpanded:I,ariaLabel:v,ariaOwns:this._dropdownDomId,ariaRole:"combobox",autoComplete:"off",autoCorrect:!1,autoFocus:m,contentBelow:u&&u(),focusOnClear:f,isCompact:a,leftAligned:c,onChange:this._handleInputChange,onClear:this._handleInputClear,onFocus:this._handleInputFocus,onLayout:this._handleInputLayoutChanged,placeholder:h,ref:this._setInputRef,returnKeyType:"search",spellCheck:"false",styleType:o?"legacyPill":p?"pill":"selection",testID:w,value:this.state.query,withClearButton:!s&&this.state.showTypeaheadDropdown})),i.a.createElement(_.a,{style:[x.typeaheadContainer,!p&&x.topBorder]},I?this._renderDropdown(e):null)))))},this._renderDropdown=e=>{const{communityId:t,filter:s,getItemDisabledMessage:o,getItemIsDisabled:r,getTopicExactMatch:a,getUserExactMatch:n,injectedItems:d,isInSidebar:c,isModal:h,isOnHomepage:l,maxEvents:u,maxTopics:p,onItemsChanged:y,orderResults:_,renderCallout:w,renderEmptyState:b,renderHeader:D,renderNoResultsState:g,renderUserDecoration:C,selectedItems:v,shouldDeferPrefetch:E,source:O,withFixedPositioning:S,withSectionDivider:j}=this.props,N=e>=I.a.theme.breakpoints.medium||Object(m.a)(),{dropdownOffset:F,query:P}=this.state,U=h?x.modalDropdown:[x.dropdown,!N&&S&&F?[Object(R.d)(F),{height:`calc(100vh - ${F}px)`}]:null,(N||l)&&x.wideModeDropdown,this._withNewTypeaheadUI&&c&&T(e),l&&x.shortModeDropdown,!N&&l&&x.shortModeDropdownMobile],q={ariaDescendantId:this.state.ariaDescendantId,domId:this._dropdownDomId,onDismiss:this._handleOnEmptyStateDismiss,onItemFocusChanged:this._handleItemFocusChanged,ref:this._handleDropdownRef,style:U};return b&&!P?b(q):i.a.createElement(f.a,{ariaDescendantId:this.state.ariaDescendantId,communityId:t,domId:this._dropdownDomId,filter:s,getItemDisabledMessage:o,getItemIsDisabled:r,getTopicExactMatch:a,getUserExactMatch:n,injectedItems:d,maxEvents:u,maxTopics:p,onItemClick:this._handleItemClick,onItemFocusChanged:this._handleItemFocusChanged,onItemsChanged:y,orderResults:_,query:P,ref:this._handleDropdownRef,renderCallout:w,renderHeader:D,renderNoResultsState:g,renderUserDecoration:C,selectedItems:v,shouldDeferPrefetch:E,source:O,style:U,withSectionDivider:j})},this._dismissDropdown=()=>{this.setState({showTypeaheadDropdown:!1}),this.props.onDismiss&&this.props.onDismiss()},this._handleOnEmptyStateDismiss=()=>{this._dismissDropdown(),this._inputRef&&this._inputRef.blur()},this._handleLayout=()=>{this._updatePosition()},this._handleInputLayoutChanged=()=>{this._updatePosition()},this._updatePosition=()=>{if(!this._inputContainerNode)return;const{bottom:e}=this._inputContainerNode.getBoundingClientRect();e!==this.state.dropdownOffset&&this.setState({dropdownOffset:e})},this._handleDropdownRef=e=>{this._dropdownRef=e},this._setRootContainerNode=e=>{this._rootContainerNode=e||null},this._setInputRef=e=>{this._inputRef=e},this._setInputContainerNode=e=>{this._inputContainerNode=e||null,this._inputContainerNode&&this._updatePosition()},this._handleFocusChange=e=>{const t=g.a.getCount()>0;this._rootContainerNode&&this._rootContainerNode.contains(e.target)||t||this.state.showTypeaheadDropdown&&this._dismissDropdown()},this._handleKeyDown=e=>{const{key:t}=e,{showTypeaheadDropdown:s}=this.state;if(Object(R.g)(e)){if(t===o.a)return this._focusNext(),void e.preventDefault();if(t===o.b)return this._focusPrevious(),void e.preventDefault();if(t===o.d)return this._dismissDropdown(),void e.preventDefault();if(t!==o.f)return t===o.c&&this._hasFocusedItem()?(this._selectFocusedItem(),void e.preventDefault()):void(s||this.setState({showTypeaheadDropdown:!0}));this._dismissDropdown()}},this._handleItemFocusChanged=()=>{this.setState({ariaDescendantId:Object(R.b)()})},this._handleInputClear=()=>{this.setQuery("")},this._handleInputFocus=()=>{this.setState({showTypeaheadDropdown:!0}),this._updatePosition(),this.props.onFocus&&this.props.onFocus()},this._handleInputChange=e=>{this.setQuery(e.target.value),this._updatePosition()},this._handleFormSubmit=e=>{e.preventDefault(),e.stopPropagation(),this._inputRef&&this._inputRef.blur(),this.setState({showTypeaheadDropdown:!1}),this.props.onDismiss&&this.props.onDismiss(),this.props.onSubmit&&this.props.onSubmit()},this._handleItemClick=(e,t)=>{const{onDismiss:s,onItemClick:o,shouldClearOnSelect:r,shouldFocusOnClear:i}=this.props,a=r?"":this.state.query;this.setState({showTypeaheadDropdown:!1}),this._inputRef&&(r&&i?this._inputRef.focus():this._inputRef.blur()),this.setQuery(a),s&&s(),o&&o(e,t)},this._hasFocusedItem=()=>this._dropdownRef&&this._dropdownRef.hasFocusedItem(),this._selectFocusedItem=()=>{this._dropdownRef&&this._dropdownRef.selectFocusedItem()},this._focusNext=()=>{this._dropdownRef&&this._dropdownRef.focusNext()},this._focusPrevious=()=>{this._dropdownRef&&this._dropdownRef.focusPrevious()},this.state={ariaDescendantId:Object(R.b)(),query:e.initialValue,showTypeaheadDropdown:!1},this._dropdownDomId=`typeaheadDropdown-${O}`,O+=1,this._withNewTypeaheadUI=this.context.featureSwitches.isTrue("responsive_web_account_search_readability_enabled")}UNSAFE_componentWillReceiveProps(e){this.props.initialValue!==e.initialValue&&this.setQuery(e.initialValue)}componentDidMount(){window.document.addEventListener("click",this._handleFocusChange,!0)}componentWillUnmount(){window.document.removeEventListener("click",this._handleFocusChange,!0)}render(){return i.a.createElement(C.a,null,this._render)}focus(){this._inputRef&&this._inputRef.focus()}setQuery(e){this.setState({query:e}),this.props.onQueryChange&&this.props.onQueryChange(e)}}S.defaultProps={disableClearButton:!1,filter:[y.a.Users,y.a.Topics],isInSidebar:!1,initialValue:"",withSectionDivider:!0},S.contextType=w.a;const x=I.a.create((e=>({root:{flex:1,flexDirection:"column",position:"relative",zIndex:u.d+1},typeaheadContainer:{flex:1,position:"relative"},keydownInputListener:{flexShrink:1},dropdown:{backgroundColor:e.colors.cellBackground,left:0,right:0,overflowY:"auto",overscrollBehavior:"contain",position:"absolute",top:0,WebkitOverflowScrolling:"touch"},modalDropdown:{backgroundColor:e.colors.cellBackground,flex:1,minHeight:300,position:"relative",overflowY:"auto",overscrollBehavior:"auto",WebkitOverflowScrolling:"touch"},wideModeDropdown:{borderRadius:e.borderRadii.medium,boxShadow:e.boxShadows.medium,minHeight:100,maxHeight:`calc(80vh - ${e.componentDimensions.appBarHeight})`},shortModeDropdown:{minHeight:100,maxHeight:"35vh",paddingBottom:"0"},shortModeDropdownMobile:{position:"absolute",height:"40vh",top:0},wrapper:{alignItems:"stretch",flex:1},topBorder:{borderTopColor:e.colors.gray200,borderTopStyle:"solid",borderTopWidth:e.borderWidths.small}})));t.default=S},OEYw:function(e,t,s){"use strict";var o=s("97Jx"),r=s.n(o),i=s("ERkP"),a=s.n(i),n=(s("kYxP"),s("hqKg")),d=s("oEoC"),c=s("o52z"),h=s("kGix"),l=s("M0jS"),u=s("Qyxo"),p=s("lnti"),m=s("rxPX"),f=s("0KEI"),y=(s("MvUL"),s("/kEJ")),_=s("oEOe"),w=s("vy4g"),I=s("3A2y"),b=s("Y6L+"),D=s("9EWH"),g=s("Ssj5"),C=s("GZwR");const R="typeaheadV2",v=[],E=Object.freeze({REQUEST:"rweb/typeaheadV2/FETCH_REQUEST",SUCCESS:"rweb/typeaheadV2/FETCH_SUCCESS",FAILURE:"rweb/typeaheadV2/FETCH_FAILURE"}),T=({q:e,result_type:t,src:s},o)=>{let r=t;return null!=o&&o.communityId&&(r=`${t}_${o.communityId}`),`${e}_${r}_${s}`},O={remoteResults:{},cachedIds:[]};const S=e=>e.map((({rounded_score:e,tokens:t,...s})=>{const{topic:o}=s,r=C.b.Topic;return{id:`${r}_${o.replace(" ","_")}`,type:r,tokens:t,rounded_score:e,data:s}})),x=e=>e.map((({rounded_score:e,tokens:t,...s})=>{var o;const r=C.b.Event,i=null==s||null==(o=s.url)?void 0:o.match(b.A.id);return{id:(null==i?void 0:i[0])||"",type:r,tokens:t,rounded_score:e,data:s}})),j=(e,t)=>e.typeaheadV2.remoteResults[t],N=(e,t)=>(s,o)=>{const r=j(o(),T(e,t)),i=r&&r.timestamp;return i&&Date.now()-i<=3e5?Promise.resolve():s(F(e,t))},F=(e,t)=>(s,o,{api:r})=>{if(!e||!e.q||""===e.q.trim())return Promise.resolve();const i={queryId:T(e,t)},{communityId:a}=t||{},n=e.result_type.split(","),d={actionTypes:E,context:"FETCH_TYPEAHEAD",meta:i};if(n.includes(C.a.CommunityUsers)&&a){const t=e=>{const{entities:t}=(null==e?void 0:e.invite_action_results)||{};return t?[Object(y.c)(t)]:void 0};return Object(_.b)(s,{params:{communityId:a,prefix:e.q},request:r.Typeahead.fetchCommunityInviteUsers})(d,t)}if(n.includes(C.a.CommunityMembers)&&a){const t=e=>{const{entities:t}=(null==e?void 0:e.user_community_relationships)||{};return t?[Object(y.c)(t)]:void 0};return Object(_.b)(s,{params:{communityId:a,prefix:e.q},request:r.Typeahead.fetchCommunityMembers})(d,t)}return Object(_.b)(s,{params:e,request:r.Typeahead.fetch})(d)};g.a.register({[R]:function(e=O,t){switch(t.type){case E.REQUEST:{const{meta:{queryId:s}}=t;return Object(D.a)(e,(e=>{e.remoteResults[s]||(e.remoteResults[s]={fetchStatus:h.a.NONE}),e.remoteResults[s].fetchStatus=h.a.LOADING}))}case E.SUCCESS:{const{meta:{queryId:s},payload:o}=t;if(!o)return e;const r=o.users.map((e=>Object(w.a)(e,C.c.Remote))),i={fetchStatus:h.a.LOADED,id:s,orderedSections:o.ordered_sections,events:x(o.events),topics:S(o.topics),users:Object(C.i)(r),timestamp:Date.now()};return Object(D.a)(e,(e=>{e.cachedIds=e.cachedIds.filter((e=>e!==s)),e.cachedIds.push(s),e.cachedIds.length>=25&&(e.remoteResults=Object(I.a)(e.remoteResults,e.cachedIds.splice(0,1))),e.remoteResults[s]=i}))}case E.FAILURE:{const{meta:{queryId:s}}=t;return Object(D.a)(e,(e=>{e.remoteResults[s].fetchStatus=h.a.FAILED}))}default:return e}}});var P=s("UQTn");const U=[C.a.Users],q=e=>{const{communityId:t,filter:s,query:o,source:r}=e;return T({q:o,result_type:(s||U).join(","),src:r},{communityId:t})},L=(e,t)=>((e,t)=>{const s=j(e,t);return s&&s.fetchStatus})(e,q(t)),k=(e,t)=>((e,t)=>{const s=j(e,t);return s&&s.users||v})(e,q(t)),A=(e,t)=>((e,t)=>{const s=j(e,t);return s&&s.topics||v})(e,q(t)),M=(e,t)=>((e,t)=>{const s=j(e,t);return s&&s.events||v})(e,q(t)),H=(e,t)=>(t.rounded_graph_weight||0)-(e.rounded_graph_weight||0),V=()=>Object(n.createSelector)(k,Object(n.createSelector)(((e,t)=>t.query),((e,t)=>t.filter),P.d,P.e,((e,t,s,o)=>{if(!e||!t||t.indexOf(C.a.Users)<0)return Object(c.a)();const r=Object(P.f)(s,e);return Object(C.i)(r.map((e=>o[e])).sort(H).slice(0,10))})),L,((e,t)=>t.injectedItems),((e,t)=>t.query),((e,t)=>t.getUserExactMatch),((e,t)=>t.userLimit),((e,t,s,o,r,i,a)=>{const n=Object(u.a)(o||[],(e=>e.type===C.b.User?e.data.id_str:void 0)),l=t.filter((e=>n.indexOf(e.id)<0)),p=e.filter((e=>n.indexOf(e.id)<0)),m=Object(d.a)(l,p).slice(0,a||10),f=s===h.a.LOADED,y=i&&i({query:r,hasResults:!!e.length,isLoaded:f}),_=y?[...m,y]:m;return _.length?_:Object(c.a)()})),W=()=>Object(n.createSelector)(V(),Object(n.createSelector)(A,L,((e,t)=>t.query),((e,t)=>t.maxTopics),((e,t)=>t.getTopicExactMatch),((e,t,s,o,r)=>{const i=t===h.a.LOADED,a=r&&r({query:s,hasResults:!!e.length,isLoaded:i}),n=e.slice(0,o||3);return a&&n.push(a),n.length?n:Object(c.a)()})),Object(n.createSelector)(M,L,((e,t)=>t.query),((e,t)=>t.maxEvents),((e,t)=>t.filter),((e,t,s,o,r)=>{const i=s&&r&&r.indexOf(C.a.Events)>=0,a=e.slice(0,o||1);return a.length&&i?a:Object(c.a)()})),((e,t)=>t.injectedItems),((e,t)=>t.orderResults),((e,t,s,o,r)=>{const i=o&&o.length?o:null,a=r?r(i,e,t,s):Object(p.a)([i,s.length?s:void 0,t.length?t:void 0,e.length?e:void 0]);return t.length||e.length||s.length?a:i?[i]:Object(c.a)()}));var B=Object(m.a)().propsFromState((()=>({fetchStatus:L,items:W()}))).propsFromActions((()=>({createLocalApiErrorHandler:Object(f.createLocalApiErrorHandlerWithContextFactory)("TYPEAHEAD_DROPDOWN_CONTAINER_CONTEXT"),fetchTypeaheadIfNeeded:N,fetchUsersPresenceIfNeeded:l.b.fetchManyIfNeeded,prefetchTypeaheadUsersIfNeeded:P.b}))).withAnalytics({element:"typeahead"}),Q=s("8UdT"),$=s("kIAd"),Y=s("Rp9C"),K=s("tAeL"),z=s("v6aA"),J=s("VY6S"),G=s("w6IS");class Z extends a.a.Component{constructor(e,t){super(e,t),this._fetchTypeaheadResultsIfNeeded=e=>{e.query&&e.fetchTypeaheadIfNeeded({q:e.query,src:e.source,result_type:e.filter.join(","),context_text:e.contextText,topic_type:e.topicType},{communityId:e.communityId}).catch(e.createLocalApiErrorHandler({}))},this._handleItemClick=(e,t)=>{const{analytics:s,onItemClick:o,query:r}=this.props;o(e,t);const i=Y.a.forTypeaheadResult(e,t),a=i?[i]:void 0;s.scribe({action:"click",data:{search_details:{query:r},targets:a}})},this._scribeResults=()=>{const{analytics:e,items:t,query:s}=this.props;e.scribe({action:"impression",data:{items:Y.a.forTypeaheadResults(t),search_details:{query:s}}})},this._debouncedFetchTypeaheadResultsIfNeeded=Object(J.a)(this._fetchTypeaheadResultsIfNeeded,250),this.state={shouldShowPrefetchResults:!0}}componentDidMount(){const{createLocalApiErrorHandler:e,prefetchTypeaheadUsersIfNeeded:t}=this.props;this._debouncedFetchTypeaheadResultsIfNeeded(this.props),t().catch(e({}))}componentWillUnmount(){clearTimeout(this._prefetchResultsTimer)}componentDidUpdate(e){const{createLocalApiErrorHandler:t,fetchUsersPresenceIfNeeded:s,filter:o,items:r,onItemsChanged:i,query:a,shouldDeferPrefetch:n,source:d}=this.props,{filter:c,query:l,source:u}=e,{loggedInUserId:p}=this.context,m=this.context.featureSwitches.isTrue("voice_rooms_typeahead_audiospace_ring_enabled")&&p;if(null!=r&&r.length&&r!==e.items&&(this._scribeResults(),i&&i(r),m)){const e=Object(G.a)(r).filter((e=>e.type===Q.b.User)).map((e=>e.id));e&&s(e).catch(t({}))}a===l&&o===c&&d===u||(this._debouncedFetchTypeaheadResultsIfNeeded(this.props),n&&(clearTimeout(this._prefetchResultsTimer),this.setState({shouldShowPrefetchResults:!1}),this._prefetchResultsTimer=setTimeout((()=>{this.props.query&&this.props.fetchStatus!==h.a.LOADED&&this.setState({shouldShowPrefetchResults:!0})}),$.a)))}render(){const{analytics:e,communityId:t,contextText:s,createLocalApiErrorHandler:o,dropdownRef:i,fetchStatus:n,fetchTypeaheadIfNeeded:d,fetchUsersPresenceIfNeeded:c,filter:l,getTopicExactMatch:u,getUserExactMatch:p,injectedItems:m,items:f,maxEvents:y,maxTopics:_,onItemClick:w,onItemsChanged:I,orderResults:b,prefetchTypeaheadUsersIfNeeded:D,query:g,shouldDeferPrefetch:C,topicType:R,userLimit:v,...E}=this.props,T=g&&n!==h.a.LOADED,O=T&&!this.state.shouldShowPrefetchResults?m:f;return a.a.createElement(K.a,r()({},E,{isLoading:!!T,items:O,onItemClick:this._handleItemClick,query:g,ref:i}))}}Z.contextType=z.a,Z.defaultProps={filter:[C.a.Users],injectedItems:[],maxEvents:3,maxTopics:1};const X=a.a.forwardRef(((e,t)=>a.a.createElement(Z,r()({},e,{dropdownRef:t})))),ee=B.forwardRef(X);t.a=ee},o52z:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s("VPAj");const r=Object(o.a)([]);Object(o.a)({})}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~loader.Typeahead~bundle.Communities~bundle.Delegate~bundle.LoggedOutHome~bundle.Search~bundle.UserList.f69b8455.js.map